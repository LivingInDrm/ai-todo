# æç®€ TodoList â€” äº§å“è®¾è®¡æ–‡æ¡£

> **ä¸€å¥è¯å®šä½**
> æç®€çš„ä»£åŠç®¡ç†(todo list)APPï¼Œæ”¯æŒè¯­éŸ³è¾“å…¥

---

## 0. äº§å“èŒƒå›´

| åŠŸèƒ½æ¨¡å—   | è¯´æ˜                                 | MVP å¿…å« |
| ------ | ---------------------------------- | ------ |
| ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ | æ–°å»ºã€æŸ¥çœ‹ / ç¼–è¾‘ã€å®Œæˆ / æ¢å¤ã€å»¶åã€ç½®é¡¶ã€åˆ é™¤ã€ç´§æ€¥æ ‡è®°   | âœ…      |
| ä¸‰è§†å›¾    | **Focus / Backlog / Done** åˆ—è¡¨åˆ‡æ¢    | âœ…      |
| è¯­éŸ³è¾“å…¥   | Whisper â†’ LLM è§£ææ‰¹é‡æ“ä½œï¼Œæ’å…¥ã€Œå¾…ç¡®è®¤åŒºã€      | âœ…      |
| æœ¬åœ°æé†’   | `due_ts â€“ 30 min` æ¨é€ï¼ˆä»…å«æ—¥æœŸé»˜è®¤ 09:00ï¼‰ |   âœ…    |
| äº‘åŒæ­¥    | Supabase Realtimeï¼›æœ€åå†™å…¥è¦†ç›–           | âœ…      |
| è®¾ç½®     | æ³¨å†Œç™»å½•/è¯­è¨€åˆ‡æ¢                  | âœ…  |

---

## 1. æ ¸å¿ƒè®¾è®¡ç†å¿µ



1. **æç®€è§†å›¾**
   ä»… **Focus / Backlog / Done** ä¸‰ä¸ªåˆ—è¡¨ï¼Œä»»åŠ¡æŒ‰æ—¶åºä¸çŠ¶æ€è‡ªç„¶æµè½¬ã€‚
2. **å•å…¥å£å¡ç‰‡**
   æ–°å»ºã€æŸ¥çœ‹ã€ç¼–è¾‘ç»Ÿä¸€åœ¨åº•éƒ¨ **Bottom Sheet** ä¸­å®Œæˆã€‚
3. **æœ€å°‘éšå¼æ‰‹åŠ¿**

   * å³æ»‘ â‰ˆ 30 %ï¼šå®Œæˆ â†” æ¢å¤
   * å·¦æ»‘ â†’ â‹¯ï¼šå»¶å / ç½®é¡¶ / åˆ é™¤
4. **å­—æ®µæç®€**
   `id, title, due_ts, urgent, status, completed_ts, created_ts, updated_ts, pending, remote_idï¼ˆç”¨äºæœ¬åœ°æ•°æ®åº“å¯¹é½supabaseçš„id)`
5. **æ‰€è§å³æ‰€å¾— & å¯æ’¤é”€**
   åˆ—è¡¨å³çœŸæ•°æ®ï¼Œæ‰€æœ‰æ‰¹é‡æ“ä½œ 3 s å†…å¯ä¸€é”®æ’¤é”€ã€‚

---

## 2. ä¿¡æ¯æ¶æ„ï¼ˆIAï¼‰

```
TaskListScreen (å•é¡µ)
â”œâ”€ Tabsï¼šFocus | Backlog | Done
â”œâ”€ Draft åŒºåŸŸï¼ˆè¯¥åŒºåŸŸä¸æ˜¯å¸¸é©»çš„ï¼Œä»…åœ¨è¯­éŸ³è¾“å…¥åŠŸèƒ½çš„è¿‡ç¨‹ä¸­å±•ç°ï¼‰
â”‚   â””â”€ åŠ¨ä½œæ ‡è¯†ï¼ˆæ–°å¢ã€æ›´æ”¹ã€å®Œæˆã€åˆ é™¤ï¼‰
â”‚   â””â”€ TaskCell
â”œâ”€ Active åŒºåŸŸ
â”‚   â””â”€ TaskCell â€¦
â””â”€ EmptyStateï¼ˆè§†å›¾ä¸“å±æ–‡æ¡ˆï¼‰
åº•éƒ¨ï¼šğŸ¤ è¯­éŸ³è¾“å…¥â€ƒ|â€ƒâ• æ–°å¢ä»»åŠ¡
é¡¶æ å³ï¼šâš™ è®¾ç½®å…¥å£
```

---

## 3. å…³é”®ç”¨æˆ·åŠ¨ä½œï¼ˆå…«å¤§åŠ¨ä½œï¼‰

| åŠ¨ä½œ          | è§¦å‘æ–¹å¼                         | ç³»ç»Ÿè¡Œä¸º                    |
| ----------- | ---------------------------- | ----------------------- |
| æ–°å»º          | å³ä¸‹ **ï¼‹** â†’ è¾“å…¥æ ‡é¢˜ â†’ å…³é—­å¡ç‰‡       | è‡ªåŠ¨ä¿å­˜å¹¶æ’å…¥åˆ—è¡¨               |
| æŸ¥çœ‹ / ç¼–è¾‘     | ç‚¹ä»»åŠ¡è¡Œ                         | æ‰“å¼€ Bottom Sheet å®æ—¶ä¿®æ”¹    |
| å®Œæˆ / æ¢å¤     | **å³æ»‘â‰ˆ30 %**                  | `status` åˆ‡æ¢ï¼›è‡ªåŠ¨è¿ç§»åˆ—è¡¨      |
| å»¶å          | å·¦æ»‘ â†’ â‹¯ â†’ ä»Šæ™š / æ˜å¤© / æœ¬å‘¨æœ« / è‡ªå®šä¹‰ | æ›´æ–° `due_ts`             |
| ç½®é¡¶ï¼ˆä»… Focusï¼‰ | å·¦æ»‘ â†’ â‹¯ â†’ ç½®é¡¶                  | å°†ä»»åŠ¡ç½®äº Focus é¦–ä½          |
| åˆ é™¤          | å·¦æ»‘ â†’ â‹¯ â†’ åˆ é™¤                  | æœ¬åœ°ç§»é™¤å¹¶åŒæ­¥äº‘ç«¯               |
| åŒæ­¥          | åˆ—è¡¨ä¸‹æ‹‰                         | è§¦å‘ Supabase Realtime è¦†ç›– |

> **Draft ç‰¹æ®ŠåŠ¨ä½œ**
> åœ¨å¾…ç¡®è®¤åŒºï¼Œä»»åŠ¡äº¦å¯ **å³æ»‘â‰ˆ30 %** ç›´æ¥ç¡®è®¤å¹¶ç§»å‡º Draftï¼Œè·³è¿‡å¤é€‰æ¡†æµç¨‹ã€‚

---

## 4. åˆ—è¡¨è§†å›¾ä¸æ’åºé€»è¾‘

| è§†å›¾          | ä»»åŠ¡èŒƒå›´                | æ’åº                      |
| ----------- | ------------------- | ----------------------- |
| **Focus**   | ä»Šæ—¥ã€é€¾æœŸã€æœªæ¥ 7 å¤©        | `due_ts â†‘`              |
| **Backlog** | æ— æ—¥æœŸæˆ– `due_ts â‰¥ 8 å¤©` | `created_ts â†“`          |
| **Done**    | æœ€è¿‘ 30 å¤©å·²å®Œæˆ          | `completed_ts â†“`ï¼ˆå³æ»‘å¯æ¢å¤ï¼‰ |

### 4.1 Empty State æ–‡æ¡ˆ

* **Focus**ï¼šä»Šå¤©æ²¡æœ‰å¾…åŠï¼Œå¥½å¥½ä¼‘æ¯ï¼
* **Backlog**ï¼šæš‚æ— è®¡åˆ’ä»»åŠ¡ï¼Œæ¥ç‚¹çµæ„Ÿå§ï½
* **Done**ï¼šè¿‘ 30 å¤©æ— å·²å®Œæˆä»»åŠ¡

### 4.2 TaskCell ç»“æ„

```
â˜ / âœ… | â—ï¸3 px çº¢æ¡ï¼ˆå¯é€‰ï¼‰ | æ ‡é¢˜ â‰¤ 2 è¡Œ | HH:mm / MM-DD
```

* å®Œæˆä»»åŠ¡ï¼šæ ‡é¢˜ç° 50 % + åˆ é™¤çº¿ï¼Œçº¢æ¡éšè—
* Focus æ˜¾ç¤º HH\:mmï¼Œå…¶ä½™è§†å›¾æ˜¾ç¤º MM-DD

---

## 5. ä»»åŠ¡å¡ç‰‡ Bottom Sheet

| æ¨¡å—          | è¡Œä¸º                                             |
| ----------- | ---------------------------------------------- |
| **æ ‡é¢˜è¾“å…¥**    | è‡ªåŠ¨èšç„¦ï¼Œå¯å¤šè¡Œï¼ˆâ‰¤ 2 è¡Œï¼‰ï¼›ç©ºæ ‡é¢˜å…³é—­è§†ä¸ºæ”¾å¼ƒ                      |
| **ğŸ•’ æ—¥æœŸæŒ‰é’®** | æœªè®¾æ—¶æ˜¾ã€Œæ·»åŠ æ—¥æœŸã€â†’ è°ƒç³»ç»Ÿ DateTimePickerï¼›å·²è®¾æ—¶æ˜¾ç¤ºæ—¥æœŸï¼Œå¯ç‚¹ âœ• æ¸…ç©º |
| **â—ï¸ ç´§æ€¥æŒ‰é’®** | åˆ‡æ¢æ™®é€š / ç´§æ€¥ï¼ˆçº¢æ¡ï¼‰                                  |
| **å…³é—­æ‰‹åŠ¿**    | å³ä¸Š âœ• æˆ–ä¸‹æ»‘ï¼›`debounce 400 ms` è‡ªåŠ¨ä¿å­˜ï¼Œå…³é—­æ—¶å¼ºåˆ¶ flush    |

---

## 6. æ—¶é—´ä¸æé†’

* DateTimePicker æ”¯æŒåˆ†é’Ÿçº§ï¼›ä»…æ—¥æœŸåˆ™é»˜è®¤ 09:00ã€‚
* æœ¬åœ°é€šçŸ¥ï¼š`due_ts â€“ 30 min` æ¨é€ã€‚
* å¯åŠ¨æ—¶è‡ªåŠ¨æ¸…ç† 30 å¤©å‰ Done è®°å½•ã€‚

---

## 7. æ•°æ®æ¨¡å‹ä¸åŒæ­¥

```sql
CREATE TABLE tasks (
  id           TEXT PRIMARY KEY,
  title        TEXT NOT NULL,
  due_ts       INTEGER,          -- NULL = æ— æ—¥æœŸ
  urgent       INTEGER DEFAULT 0,
  status       INTEGER DEFAULT 0,-- 0 active | 1 completed
  pending      INTEGER DEFAULT 0,-- 0 æ­£å¼ | 1 è‰ç¨¿
  pinned_at    INTEGER DEFAULT 0,
  remote_id    TEXT,
  completed_ts INTEGER,
  created_ts   INTEGER,
  updated_ts   INTEGER
);
```

* **æœ¬åœ°å­˜å‚¨**ï¼šexpo-sqlite
* **äº‘åŒæ­¥**ï¼šSupabase Realtimeã€Œæœ€åå†™å…¥è¦†ç›–ã€ç­–ç•¥
* **é”™è¯¯å¤„ç†**ï¼šç½‘ç»œå¤±è´¥ Toast æç¤ºï¼›è¯­éŸ³æŒ‰é’®ç¦»çº¿ç½®ç°

---

## 8. è¯­éŸ³è¾“å…¥æ¨¡å—

### 8.1 åŠŸèƒ½å®šä½

ä¸€å¥è¯­éŸ³ / æ–‡æœ¬ â†’ è§£æå¤šæ¡ Todo è‰ç¨¿ â†’ æ’å…¥ **Focus** é¡¶éƒ¨ã€Œâ³ å¾…ç¡®è®¤åŒºã€â†’ ç”¨æˆ·å‹¾é€‰ç¡®è®¤ï¼Œæ‰¹é‡æ–°å¢ / æ›´æ–° / å®Œæˆä»»åŠ¡ã€‚

### 8.2 æ ¸å¿ƒæµç¨‹

1. **å½•éŸ³**
   é•¿æŒ‰ ğŸ¤ï¼ˆâ‰¤ 60 sï¼‰ï¼›ç»“æŸå Whisper â†’ LLM â†’ `operations[]`ã€‚
2. **å†™å…¥è‰ç¨¿**
   `pending=1` å†™å…¥ expo-sqliteï¼›Draft åŒºåŸŸæ·¡å…¥ã€‚
3. **ç”¨æˆ·ç¡®è®¤**
   * è‰ç¨¿è¡Œå¤é€‰æ¡†é»˜è®¤é€‰ä¸­ï¼Œå¯é€æ¡å–æ¶ˆã€‚
   * åº•éƒ¨æµ®æ¡ï¼š**å…¨é€‰ / å–æ¶ˆå…¨é€‰** + **ç¡®è®¤**ï¼ˆâ‰¥ 1 é¡¹é«˜äº®ï¼‰ã€‚
   * ç‚¹å‡»ç¡®è®¤ï¼šæ‰¹é‡å°†é€‰ä¸­è‰ç¨¿ pendingâ†’0ï¼›æœªå‹¾é€‰è‰ç¨¿å³æ—¶åˆ é™¤
   * **å³æ»‘â‰ˆ30 %**ï¼šå¯ç›´æ¥å•æ¡ç¡®è®¤å¹¶è½¬ Activeã€‚
4. **æ’¤é”€çª—å£**
   Snackbar åœç•™ 3 sï¼šã€Œå·²æ·»åŠ  N é¡¹ï¼Œå·²å®Œæˆ M é¡¹ Â· æ’¤é”€ã€ã€‚

### 8.3 ç•Œé¢è¦ç´ 

| å…ƒç´               | è¯´æ˜                                                           |
| --------------- | ------------------------------------------------------------ |
| **Draft åŒºåŸŸ**    | å¹³æ—¶éšè—ï¼Œä»…åœ¨è¯¥æµç¨‹ä¸­å‡ºç°åœ¨ Focus é¡¶éƒ¨ï¼Œæ·¡è“èƒŒæ™¯ï¼›æ ‡é¢˜ã€Œâ³ å¾…ç¡®è®¤ (N)ã€ï¼Œæ”¯æŒç‚¹å‡» **æŠ˜å  / å±•å¼€**ï¼›è¶…å‡º 10 æ¡æˆªæ–­å¹¶æç¤º |
| **è‰ç¨¿ TaskCell** | ç»§æ‰¿ç°æœ‰æ ·å¼ + å‹¾é€‰æ¡†ï¼›åŠ¨ä½œå›¾æ ‡åŒºåˆ†è‰²ï¼šâ•è“ / âœé»„ / âœ“ç»¿                            |
| **åº•éƒ¨æµ®æ¡**        | éšåˆ—è¡¨æ»šåŠ¨æ·¡å…¥æ·¡å‡ºï¼Œå®‰å…¨åŒºå†…å›ºå®š                                             |
| **Snackbar**    | å‘ˆç°æäº¤ç»“æœ + æ’¤é”€æŒ‰é’®                                                |

### 8.4 æ•°æ®ä¸äº‹åŠ¡

* è‰ç¨¿åŠæ‰¹é‡ç¡®è®¤å‡æ‰“åŒ…ä¸ºå•äº‹åŠ¡ï¼›å¤±è´¥æ•´ä½“å›æ»šã€‚
* **App é€€å‡º**ï¼š`pending=1` è®°å½•æŒä¹…ä¿å­˜ï¼Œé‡å¯å Draft ä»åœ¨ã€‚
* æ’¤é”€åœ¨ 3 s å†…é€†è½¬åŒä¸€äº‹åŠ¡ã€‚

### 8.5 è¾¹ç•Œä¸é”™è¯¯å¤„ç†

| åœºæ™¯        | è¡Œä¸º                    |
| --------- | --------------------- |
| è§£æå¤±è´¥      | Toastã€Œæš‚æœªè¯†åˆ«ä»»åŠ¡ã€ï¼Œä¸äº§ç”Ÿè‰ç¨¿   |
| è‰ç¨¿ > 10 æ¡ | ä»…ä¿ç•™å‰ 10 æ¡ï¼Œå¤šä½™ä¸¢å¼ƒå¹¶æç¤º     |
| ç¦»çº¿æ¨¡å¼      | è¯­éŸ³æŒ‰é’®ç½®ç°ï¼Œæç¤ºã€Œç¦»çº¿æ¨¡å¼æš‚ä¸æ”¯æŒè¯­éŸ³ã€ |

### 8.6 åŠ¨æ•ˆ

| åŠ¨ä½œ         | åŠ¨æ•ˆ                                        |
| ---------- | ----------------------------------------- |
| Draft åŒºåŸŸå‡ºç° | `opacity 0â†’1`, `translateY 16â†’0` (200 ms) |
| å‹¾é€‰åˆ‡æ¢       | å‹¾é€‰æ¡†ç¼©æ”¾ +15 %, é¢œè‰²è¿‡æ¸¡ 100 ms                  |
| è‰ç¨¿è½¬æ­£å¼      | è¡ŒèƒŒæ™¯æ·¡åŒ–è‡³ç™½è‰²å¹¶ä¸‹æ»‘è¡¥ä½ (200 ms)                    |

---

## 9. ç»„ä»¶å¤ç”¨ä¸€è§ˆ

| ç±»å‹      | åç§°                 | ä½œç”¨                 | å¤ç”¨ç­–ç•¥            |
| ------- | ------------------ | ------------------ | --------------- |
| **é¡µé¢**  | TaskListScreen     | ä¸‰è§†å›¾æŒ‰è¿‡æ»¤è§„åˆ™æ¸²æŸ“         | å•é¡µå¤ç”¨            |
|         | SettingsScreenï¼ˆå¯é€‰ï¼‰ | ä¸»é¢˜åˆ‡æ¢ / æ¸…ç† Done ç­‰   | MVP å¯æš‚ç¼“         |
| **å¼¹å±‚**  | TaskDetailSheet    | æ–°å»º / æŸ¥çœ‹ / ç¼–è¾‘ä¸€ä½“     | å…¨å±€å”¯ä¸€            |
|         | MoreActionSheet    | å»¶å / ç½®é¡¶ / åˆ é™¤èœå•     | å…¨åˆ—è¡¨å…±ç”¨           |
| **åˆ—è¡¨é¡¹** | TaskCell           | å¤é€‰æ¡† + çº¢æ¡ + æ ‡é¢˜ + æ—¶é—´ | çŠ¶æ€å†³å®šæ ·å¼          |
| **è¾…åŠ©**  | EmptyState         | ç©ºåˆ—è¡¨å ä½æ’ç”» + æ–‡æ¡ˆ       | ä¸‰è§†å›¾å…±ç”¨           |
|         | SyncToast          | åŒæ­¥æˆåŠŸ / å¤±è´¥æç¤º        | å…¨å±€å¤ç”¨            |
|         | DateTimeButton     | ğŸ•’ æŒ‰é’® + æ—¶é—´å±•ç¤º       | Bottom Sheet å¤ç”¨ |

---

## 10. ä½ä¿çœŸçº¿æ¡†ï¼ˆFocus ç¤ºä¾‹ï¼‰

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Focus | Backlog | Done        âš™   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â³ å¾…ç¡®è®¤ (3)                       â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  + â–¡ æ˜æ—© 10:00 å¼€äº§å“ä¼š              â”‚
â”‚  - â–¡ æ˜å¤© 09:00 æäº¤æŠ¥å‘Š              â”‚
â”‚  x â–¡ ä¸‹åˆ 3 ç‚¹ å‘å‘¨æŠ¥                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â–¡ å†™å‘¨æŠ¥                          â”‚
â”‚  â–¡ ä¿®å¤ç™»å½• Bug                  â”‚
â”‚  â–¡ é¢„è®¢æ™šé¤é¤å…                    â”‚
â”‚                                    â”‚
â”‚  ï¼ˆç©ºæ€ ï¼šæ’ç”» + â€œä»Šå¤©æ²¡æœ‰å¾…åŠâ€¦â€ï¼‰ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                â”‚      ğŸ¤       â”‚ â• â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”˜
```

---

## 11. æŠ€æœ¯æ¶æ„

### 11.1 æŠ€æœ¯æ ˆ

| å±‚çº§     | é€‰å‹                             |
| ------ | ------------------------------ |
| å®¢æˆ·ç«¯    | Expo + React Native            |
| æœ¬åœ°å­˜å‚¨   | expo-sqlite          |
| å®æ—¶åŒæ­¥   | Supabase Realtime              |
| äº‘è½¬å†™    | OpenAI Whisper API             |
| LLM è§£æ | OpenAI GPT-4o function calling |
| æ¨é€     | FCMï¼ˆAndroidï¼‰/ APNsï¼ˆiOSï¼‰        |

### 11.2 æ•´ä½“æŠ€æœ¯æ¶æ„ä¸€è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Mobile Client (Expo + React Native) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â‘  å½•éŸ³                                                                                         â”‚
â”‚      â€¢ expo-av æ•è· PCM (16 kHz mono)                                                          â”‚
â”‚      â€¢ 5 s åˆ†æ®µä¸Šä¼  Whisper REST API                                                          â”‚
â”‚ â‘¡ å®æ—¶è½¬å†™å›æ˜¾                                                                                 â”‚
â”‚ â‘¢ æ–‡æœ¬ â†’ GPT-4o (å‡½æ•°è°ƒç”¨)                                                                    â”‚
â”‚      â€¢ add_todo / update_todo / complete_todo                                                 â”‚
â”‚ â‘£ æœ¬åœ°ç¼“å­˜ + UI                                                                               â”‚
â”‚      â€¢ zustand + expo-sqlite/mmkv                                                             â”‚
â”‚ â‘¤ Supabase Realtime è®¢é˜…                                                                      â”‚
â”‚      â€¢ è‡ªåŠ¨åˆå¹¶è¿œç«¯å˜æ›´                                                                        â”‚
â”‚ â‘¥ Expo Notifications                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ JWTï¼ˆAuthï¼‰ + HTTPS
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Supabase ï¼ˆä»…å­˜å‚¨ä¸é‰´æƒï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Auth â€“ é‚®ç®± / Google â†’ JWT                                                     â”‚
â”‚ Postgres â€“ `todos` è¡¨ + RLSï¼ˆæ¯è¡Œå½’å±å½“å‰ç”¨æˆ·ï¼‰                                          â”‚
â”‚ Realtime â€“ WebSocket å¹¿æ’­è¡Œçº§äº‹ä»¶                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ è¡Œçº§äº‹ä»¶
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Scheduler Micro-service â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Cloudflare Workers / Vercel Cronï¼ˆæ¯ 15 minï¼‰              â”‚
â”‚ â€¢ æŸ¥è¯¢ 30 min å†…åˆ°æœŸä¸”æœªå®Œæˆçš„ Todo                           â”‚
â”‚ â€¢ è°ƒ FCM / APNs æ¨é€æé†’                                      â”‚
â”‚ â€¢ ä»…æŒ Supabase Service Key çš„åªè¯»æƒé™                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 11.3 ç§»åŠ¨ç«¯ï¼ˆExpo + React Nativeï¼‰

| è´£ä»»       | å…³é”®å®ç°                                                                       |
| -------- | -------------------------------------------------------------------------- |
| **è¯­éŸ³å½•åˆ¶** | `expo-av` & `Audio.Recording`ï¼Œåå°å‰å°å‡å¯ç”¨                                      |
| **è½¬å†™è¯·æ±‚** | `fetch` â†’ `https://api.openai.com/v1/audio/transcriptions`ï¼ŒMPEG-4 / WAV å‡å¯ |
| **æ„å›¾è§£æ** | OpenAI Chat Completion + å‡½æ•°è°ƒç”¨ï¼Œè§£æ `function_call` è¿”å› `{action, payload}`    |
| **æœ¬åœ°çŠ¶æ€** | `zustand` å…¨å±€ storeï¼›SQLite ç¼“å­˜ç¦»çº¿é˜Ÿåˆ—ï¼›MMKV åšé¦–å±å†·å¯åŠ¨åŠ é€Ÿ                             |
| **æ•°æ®å†™å…¥** | è°ƒ Supabase JS SDK `insert/update/delete`ï¼Œå¤±è´¥æ—¶è¿›å…¥ç¦»çº¿é˜Ÿåˆ—ï¼Œç½‘ç»œæ¢å¤åè‡ªåŠ¨ flush           |
| **å®æ—¶æ•°æ®** | `supabase.channel('todos')` ç›‘å¬è¡Œçº§äº‹ä»¶ï¼Œåˆå¹¶åˆ°æœ¬åœ° store                             |
| **æ¨é€**   | `expo-notifications` æ³¨å†Œ FCM / APNs tokenï¼Œå­˜å…¥ `profiles.push_token`          |

---

### 11.4. Supabaseï¼ˆæ‰˜ç®¡å±‚ï¼‰

* **Auth**ï¼šOAuth 2 + Magic Linkï¼›JWT é€šè¿‡ Expo SecureStore ç¼“å­˜
* **Postgres**ï¼š

  * `todos` è¡¨å­—æ®µï¼š`id, user_id, title, due_at, status, priority, tags`
  * è¡Œçº§å®‰å…¨ (RLS)ï¼š`auth.uid() = user_id`
* **Realtime**ï¼šè¡Œçº§å˜åŒ–äº‹ä»¶å¹¿æ’­ï¼›å®¢æˆ·ç«¯ä»…è®¢é˜…è‡ªå·± UID çš„ channel
* **Edge Functions**ï¼š**ç¦ç”¨ä¸šåŠ¡é€»è¾‘**ï¼ˆä¿æŒ supabase=å­˜å‚¨å±‚ï¼‰ï¼›ä»…æœªæ¥åšåˆ†æ/åŸ‹ç‚¹ä¸ŠæŠ¥

---

### 11.5. Scheduler å¾®æœåŠ¡

| æ¨¡å—          | è¯´æ˜                                                       |
| ----------- | -------------------------------------------------------- |
| **Cron è§¦å‘** | `*/15 * * * *` æŸ¥è¯¢ `due_at between now() and now()+30min` |
| **æ¨é€**      | è°ƒç”¨ FCM / APNsï¼Œpayload `{ todo_id, title, due_at }`       |
| **å®‰å…¨**      | ç¯å¢ƒå˜é‡æŒ `SUPABASE_SERVICE_KEY`ï¼ˆåªè¯»ï¼‰ï¼ŒOpenAI Key ä¸åœ¨æ­¤å±‚         |

---

### 11.6 æ•°æ®æµ & æ—¶åº

1. **ç”¨æˆ·è®²è¯** â†’ å®¢æˆ·ç«¯ 5 s éŸ³é¢‘å— â†’ Whisper â†’ **æ–‡æœ¬**
2. **æ–‡æœ¬** â†’ GPT-4o â†’ `function_call` â†’ `{action, payload}`
3. å®¢æˆ·ç«¯å°† payload å†™å…¥ **Supabase**ï¼›æœ¬åœ° UI ç«‹å³æ¸²æŸ“
4. Supabase è§¦å‘ **Realtime** äº‹ä»¶ â†’ å…¶ä»–è®¾å¤‡åŒæ­¥
5. Scheduler å‘¨æœŸæ€§æ‹‰å–åˆ°æœŸä»»åŠ¡ â†’ **æ¨é€æé†’** ï¼ˆä¿è¯ç¦»çº¿ç”¨æˆ·ä¹Ÿèƒ½æ”¶åˆ°ï¼‰

---

### 11.7 å®‰å…¨ä¸åˆè§„

* **OpenAI Key** å­˜äº app config serverï¼Œå®¢æˆ·ç«¯é€šè¿‡ä¸´æ—¶ç­¾å Token è°ƒç”¨
* æ‰€æœ‰é€šä¿¡èµ° **TLS 1.3**ï¼›JWT æœ‰æ•ˆæœŸçŸ­ï¼ˆé»˜è®¤ 1 hï¼Œåå°é™é»˜åˆ·æ–°ï¼‰
* ç”¨æˆ·å¯åœ¨è®¾ç½®é¡µè§¦å‘ GDPR/CCPA æ•°æ®åˆ é™¤ï¼šç›´æ¥ `delete from todos where user_id=â€¦`
* æœ€å°æƒé™åŸåˆ™ï¼šå®¢æˆ·ç«¯ä»…æœ‰å…¶è‡ªèº«è¡Œçº§æ•°æ®ï¼›Scheduler ä»… select æƒé™


### 11.9 ä»£ç åº“ç»“æ„
AI-TODO/
â”œâ”€â”€ app/                             # Expo Router é¡µé¢ç›®å½•
â”‚   â”œâ”€â”€ _layout.tsx                  # é¡¶å±‚å¯¼èˆªç»“æ„ï¼ˆTabs / Stackï¼‰
â”‚   â”œâ”€â”€ index.tsx                    # é¦–é¡µè·³è½¬æˆ–é‡å®šå‘
â”‚   â””â”€â”€ task-list.tsx                # ä¸‰è§†å›¾ç»Ÿä¸€é¡µé¢ï¼ˆé€šè¿‡ param æ§åˆ¶ focus/backlog/doneï¼‰
â”‚
â”œâ”€â”€ components/                      # çº¯å±•ç¤ºå‹ UI ç»„ä»¶ï¼ˆæ— å‰¯ä½œç”¨ã€çŠ¶æ€ï¼‰
â”‚   â”œâ”€â”€ TaskCell.tsx                 # å•æ¡ä»»åŠ¡ï¼ˆæ”¯æŒè‰ç¨¿/å®Œæˆ/ç´§æ€¥ï¼‰
â”‚   â”œâ”€â”€ TaskTabs.tsx                 # é¡¶éƒ¨åˆ‡æ¢æ ï¼ˆFocus / Backlog / Doneï¼‰
â”‚   â”œâ”€â”€ EmptyState.tsx              # ç©ºçŠ¶æ€æ–‡æ¡ˆä¸æ’ç”»
â”‚   â”œâ”€â”€ BottomSheet.tsx             # é€šç”¨åº•éƒ¨å¼¹çª—å®¹å™¨
â”‚   â”œâ”€â”€ DateTimeButton.tsx          # æ—¥æœŸé€‰æ‹©æŒ‰é’®
â”‚   â”œâ”€â”€ VoiceButton.tsx             # ğŸ¤ é•¿æŒ‰è¯­éŸ³æŒ‰é’®
â”‚   â”œâ”€â”€ Snackbar.tsx                # æ“ä½œæç¤ºæ¡ï¼ˆå¦‚â€œæ·»åŠ æˆåŠŸ Â· æ’¤é”€â€ï¼‰
â”‚   â””â”€â”€ FloatingBar.tsx             # è‰ç¨¿æ“ä½œæµ®å±‚ï¼ˆå…¨é€‰ / ç¡®è®¤ï¼‰
â”‚
â”œâ”€â”€ features/                        # åŠŸèƒ½æ¨¡å—ï¼ˆçŠ¶æ€ã€é€»è¾‘ã€UI é€»è¾‘åˆ†å‘ï¼‰
â”‚   â”œâ”€â”€ task/                        # ä»»åŠ¡ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ã€åŒæ­¥ï¼‰
â”‚   â”‚   â”œâ”€â”€ taskStore.ts             # zustand çŠ¶æ€ï¼ˆå…¨ä»»åŠ¡åˆ—è¡¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ taskService.ts           # æœ¬åœ°/è¿œç¨‹ä»»åŠ¡æ“ä½œå°è£…
â”‚   â”‚   â”œâ”€â”€ useFilteredTasks.ts      # æŒ‰è§†å›¾ç­›é€‰ä»»åŠ¡åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ taskSync.ts              # Supabase å®æ—¶è®¢é˜… / åˆå¹¶
â”‚   â”‚
â”‚   â”œâ”€â”€ draft/                       # è‰ç¨¿ä»»åŠ¡æµï¼ˆpending=1ï¼‰
â”‚   â”‚   â”œâ”€â”€ draftStore.ts            # zustand çŠ¶æ€ï¼ˆè‰ç¨¿ä»»åŠ¡ï¼‰
â”‚   â”‚   â””â”€â”€ draftFlow.ts             # è‰ç¨¿æµç¨‹ï¼ˆç¡®è®¤ / æ’¤é”€ / åˆ é™¤ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ voice/                       # è¯­éŸ³è¯†åˆ«æµç¨‹ç»„ç»‡å™¨ï¼ˆä¸è´Ÿè´£ API ç»†èŠ‚ï¼‰
â”‚   â”‚   â”œâ”€â”€ recorder.ts              # expo-av å½•éŸ³å°è£…
â”‚   â”‚   â””â”€â”€ voiceFlow.ts             # è½¬å†™ â†’ LLM â†’ è‰ç¨¿å†™å…¥
â”‚   â”‚
â”‚   â”œâ”€â”€ auth/                        # ç™»å½•ã€èº«ä»½è¯†åˆ«
â”‚   â”‚   â”œâ”€â”€ authStore.ts             # å½“å‰ç”¨æˆ·çŠ¶æ€
â”‚   â”‚   â””â”€â”€ authService.ts           # ç™»å½•/ç™»å‡ºæµç¨‹
â”‚   â”‚
â”‚   â””â”€â”€ notify/                      # æ¨é€é€šçŸ¥è°ƒåº¦é€»è¾‘
â”‚       â”œâ”€â”€ registerPushToken.ts     # æ³¨å†Œ FCM / APNs token
â”‚       â””â”€â”€ reminderService.ts       # è®¾ç½®/æ¸…ç†ä»»åŠ¡æé†’
â”‚
â”œâ”€â”€ services/                        # å¯¹å¤– API è°ƒç”¨å°è£…
â”‚   â”œâ”€â”€ supabase.ts                  # Supabase å®¢æˆ·ç«¯åˆå§‹åŒ–ä¸å°è£…
â”‚   â”œâ”€â”€ openai.ts                    # Whisper / GPT API å°è£…
â”‚   â””â”€â”€ analytics.ts                 # åŸ‹ç‚¹ï¼ˆå¯é€‰ï¼‰
â”‚
â”œâ”€â”€ db/                              # æœ¬åœ°æ•°æ®åº“ï¼šexpo-sqlite
â”‚   â”œâ”€â”€ database.ts                  # åˆå§‹åŒ– DB å®ä¾‹
â”‚   â”œâ”€â”€ schema.ts                    # è¡¨ç»“æ„å®šä¹‰
â”‚   â””â”€â”€ models/
â”‚       â””â”€â”€ Task.ts                  # Task Model æ˜ å°„å®šä¹‰
â”‚
â”œâ”€â”€ lib/                             # é€šç”¨å·¥å…·æ–¹æ³• / ç±»å‹ / å¸¸é‡
â”‚   â”œâ”€â”€ date.ts                      # æ—¥æœŸè§£æ/æ ¼å¼åŒ–å·¥å…·
â”‚   â”œâ”€â”€ uuid.ts                      # ID ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ constants.ts                 # Tab key / æšä¸¾ / é™å€¼
â”‚   â”œâ”€â”€ types.ts                     # å…¨å±€ç±»å‹å®šä¹‰ï¼ˆTask, Operation ç­‰ï¼‰
â”‚   â””â”€â”€ i18n.ts                      # å¤šè¯­è¨€é…ç½®ï¼ˆå¦‚ä½¿ç”¨ï¼‰
â”‚
â”œâ”€â”€ assets/                          # æ’å›¾ / å›¾æ ‡ / å£°éŸ³
â”‚   â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ icons/
â”‚   â””â”€â”€ sounds/
â”‚
â”œâ”€â”€ .env                             # ç¯å¢ƒå˜é‡ï¼ˆOpenAI / Supabase keys ç­‰ï¼‰
â”œâ”€â”€ app.config.ts                    # Expo App é…ç½®ï¼ˆåç§°ã€å›¾æ ‡ã€æƒé™ç­‰ï¼‰
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json